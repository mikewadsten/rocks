(function(){var Asteroid,Environment,Grid,Node,Ship;Asteroid=function(){function Asteroid(t,i,s,e){this.xpos=t,this.ypos=i,this.xvel=s,this.yvel=e}return Asteroid.prototype.covers=function(t,i){var s,e;return s=this.xpos-t,e=this.ypos-i,s>=-1&&1>=s&&e>=-1&&1>=e},Asteroid.prototype.move=function(t){return null==t&&(t=1),new Asteroid(this.xpos+this.xvel*t,this.ypos+this.yvel*t,this.xvel,this.yvel)},Asteroid}(),window.Asteroid=Asteroid,Environment=function(){function Environment(){this.asteroids=[],this.turn=0,this.playerMove=!0,this.gridWidth=200,this.gridHeight=200}var AsteroidWrapper;return Environment.prototype.addAsteroid=function(t,i,s,e){var o,r,n,h,u;return o=new Asteroid(t,i,s,e),n=0,h=0,0===s&&(n=1/0),0===e&&(h=1/0),0>s&&(n=Math.ceil(t/-s)),s>0&&(n=Math.ceil((this.gridWidth-t)/s)),0>e&&(h=Math.ceil(i/-e)),e>0&&(h=Math.ceil((this.gridHeight-i)/e)),r=Math.min(n,h),u=new AsteroidWrapper(o,this.turn,this.turn+r),this.asteroids.push(u)},Environment.prototype.bumpMove=function(){var t;return this.playerMove||(this.turn+=1,this.asteroids=function(){var i,s,e,o;for(e=this.asteroids,o=[],i=0,s=e.length;s>i;i++)t=e[i],t.lastTurn>this.turn-20&&o.push(t);return o}.call(this)),this.playerMove=!this.playerMove},AsteroidWrapper=function(){function AsteroidWrapper(t,i,s){this.asteroid=t,this.initialturn=i,this.lastTurn=s}return AsteroidWrapper}(),Environment}(),window.Environment=Environment,Grid=function(){function Grid(t,i){this.width=t,this.height=i,this._nodes=Grid._makenodes(this.width,this.height)}return Grid._makenodes=function(t,i){var s,e,o,r,n,h,u;for(s=[],e=r=0,h=t-1;h>=0?h>=r:r>=h;e=h>=0?++r:--r)for(s[e]=[],o=n=0,u=i-1;u>=0?u>=n:n>=u;o=u>=0?++n:--n)s[e][o]=new Node(e,o);return s},Grid.prototype.getnode=function(t,i){return t>=0&&this.width>t&&i>=0&&this.width>i?this._nodes[t][i]:new Node(t,i)},Grid.prototype.occupied=function(t,i){return getnode(t,i).occupied},Grid.prototype.unsafe=function(t,i){return occupied(t-1,i+1)||occupied(t,i+1)||occupied(t+1,i+1)||occupied(t-1,i)||occupied(t,i)||occupied(t+1,i)||occupied(t-1,i-1)||occupied(t,i-1)||occupied(t+1,i-1)},Grid}(),window.Grid=Grid,Node=function(){function Node(t,i,s){this.xpos=t,this.ypos=i,this.occupied=null!=s?s:!1}return Node}(),window.Node=Node,Ship=function(){function Ship(t,i,s,e){this.xpos=t,this.ypos=i,this.gridwidth=s,this.gridheight=e,this._history=[]}return Ship.dirtobyte=function(t){switch(t){case"s":return 0;case"ul":return 1;case"up":return 2;case"ur":return 3;case"r":return 4;case"dr":return 5;case"d":return 6;case"dl":return 7;case"l":return 8;default:return 0}},Ship.prototype.move=function(t){var i;return i=this.dirtobyte(t),(1===i||7===i||8===i)&&this.xpos>0&&(this.xpos-=1),(3===i||4===i||5===i)&&this.xpos<this.gridwidth&&(this.xpos+=1),(5===i||6===i||7===i)&&this.ypos>0&&(this.ypos-=1),(1===i||2===i||3===i)&&this.ypos<this.gridheight&&(this.ypos+=1),console.log("Ship moved... "+i),this._addhistory(i),this},Ship._addhistory=function(t){return this._history.length>=50&&this._history.shift(),this._history.push(t)},Ship.prototype.gethistory=function(){return this._history},Ship}(),window.Ship=Ship}).call(this);